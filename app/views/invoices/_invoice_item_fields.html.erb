<div class="row g-2 align-items-end mb-2">
  <div class="col">
    <%= f.label :product_id, "Product" %>
    <%= f.select :product_id,
      options_for_select(
        Product.all.map { |p| [ p.name, p.id, { "data-price" => p.price } ] },
        f.object.product_id
      ),
      { prompt: "Select a product" },
      { class: "form-select product-select" }
    %>
  </div>

  <div class="col">
    <%= f.label :tax_rate_id, "Tax Rate" %>
    <%= f.collection_select :tax_rate_id,
                           TaxRate.all,
                           :id,
                           :name,
                           { prompt: "Select a tax rate" },
                           class: "form-select" %>
  </div>

  <div class="col">
    <%= f.label :quantity, "Quantity" %>
    <%= f.number_field :quantity, class: "form-control" %>
  </div>

  <div class="col">
    <%= f.label :unit_price, "Unit Price" %>
    <%= f.number_field :unit_price,
                       class: "form-control unit-price",
                       step: "0.01",
                       readonly: true %>
  </div>

</div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      function updateUnitPrice(select) {
        const selectedOption = select.options[select.selectedIndex];
        const price = selectedOption.getAttribute("data-price");
        if (price !== null) {
          const row = select.closest('.row');
          if (row) {
            const priceInput = row.querySelector('.unit-price');
            if (priceInput) {
              priceInput.value = price;
            }
          }
        }
      }

      document.querySelectorAll('.product-select').forEach(function(select) {
        select.addEventListener('change', function() {
          updateUnitPrice(this);
        });
        updateUnitPrice(select);
      });
    });
  </script>
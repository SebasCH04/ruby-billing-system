<%= form_with(model: invoice, local: true) do |f| %>
  <% if invoice.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(invoice.errors.count, "error") %> impiden guardar la factura:</h4>
      <ul><%= invoice.errors.full_messages.map { |msg| content_tag(:li, msg) }.join.html_safe %></ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :client_id, "Client" %>
    <%= f.collection_select :client_id, Client.all, :id, :name, prompt: "Select a client", class: "form-select" %>
  </div>

  <div class="row mb-3">
    <div class="col">
      <%= f.hidden_field :number %>
    </div>
    <div class="col">
      <%= f.label :issued_at, "Issue date" %>
      <%= f.date_field :issued_at, class: "form-control" %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.label :tax_rate_id, "Tax Rate" %>
    <%= f.collection_select :tax_rate_id, TaxRate.all, :id, :name, prompt: "Select a tax rate", class: "form-select" %>
  </div>

  <h4>Invoice lines</h4>
  <div id="invoice-items">
    <%= f.fields_for :invoice_items do |item_form| %>
      <%= render 'invoice_item_fields', f: item_form %>
    <% end %>
  </div>

  <div>
    <a href="#" id="add-line">Add line</a>
  </div>

  <div>
    <%= f.submit class: "btn btn-primary" %>
  </div>
<% end %>
